/*
 Project: WP-ZEP - Zero-day exploit Prevention for wp-admin
 Copyright (c) 2015-2017 tokkonopapa (tokkonopapa@yahoo.com)
 This software is released under the MIT License.
*/
(function(g,h,n){function x(a){var b=n.createElement("div");b.appendChild(n.createTextNode(a));a=b.innerHTML.replace(/["']/g,function(a){return{'"':"&quot;","'":"&#39;"}[a]});b="";return a}function p(a){a=a?a.toString():"";a=a.match(/^(?:([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{scheme:a[1]||"",relative:a[2]||"",authority:a[3]||"",path:a[4]||"",query:a[5]||"",fragment:a[6]||""}}function k(a,b){"object"!==typeof a&&(a=p(a||location.href));for(var e=a.query?a.query.split("&"):[],d=e.length;0<d--;)if(0===e[d].indexOf(f.auth)){e.splice(d,1);break}e.push(f.auth+"="+encodeURIComponent(b));a.query=e.join("&");return(a.scheme?a.scheme+":":"")+(a.relative+a.path)+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")}function q(a){return(!a.scheme||/^https?$/.test(a.scheme))&&(a.path||a.query)}function l(a){var b=a||location.pathname;b=p(b.toLowerCase());if(q(b)){b=y(a);if(b.origin!==location.origin)return-1;if((b=z.exec(b.pathname))&&(IP_GEO_BLOCK_AUTH.zep.ajax&&0<=b[0].indexOf(IP_GEO_BLOCK_AUTH.admin+"admin-")||IP_GEO_BLOCK_AUTH.zep.admin&&0<=b[0].indexOf(IP_GEO_BLOCK_AUTH.admin)||IP_GEO_BLOCK_AUTH.zep.plugins&&0<=b[0].indexOf(IP_GEO_BLOCK_AUTH.plugins)||IP_GEO_BLOCK_AUTH.zep.themes&&0<=b[0].indexOf(IP_GEO_BLOCK_AUTH.themes)))return 1}return 0}function r(){return 1===l(location.pathname)||0<=location.search.indexOf(f.auth)}function t(a,b,e){var d=b.split(/\s+/);a.each(function(a){for(a=0;a<d.length;++a){var b=g.trim(d[a]).match(/[^\.]+/i)[0],c=g(this),f=b;b=e;c=g._data(c[0]).events[f];f=b?c.splice(c.delegateCount-1,1)[0]:c.pop();c.splice(b?0:c.delegateCount||0,0,f)}})}function u(a){if(!f.init&&(f.init=!0,r()&&g("a").each(function(){this.hasAttribute("onClick")||-1!==l(this.getAttribute("href"))||this.setAttribute("onClick","javascript:return false")}),g("img").each(function(a){a=g(this).attr("src");1===l(a)&&g(this).attr("src",k(a,f.nonce))}),"undefined"!==typeof h._wpRevisionsSettings)){var b=h._wpRevisionsSettings.revisionData,e=b.length;for(a=0;a<e;++a)-1===b[a].restoreUrl.indexOf(f.auth)&&(h._wpRevisionsSettings.revisionData[a].restoreUrl=k(b[a].restoreUrl,f.nonce))}}var f={init:!1,auth:"ip-geo-block-auth-nonce",nonce:IP_GEO_BLOCK_AUTH.nonce||"",sites:IP_GEO_BLOCK_AUTH.sites||[]},z=new RegExp("^(?:"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.admin+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.plugins+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.themes+")(?:.*.php|.*/)?$"),v=function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("request%5Bbrowse%5D=ip-geo-block-auth")){a[b]="request%5Bbrowse%5D=featured";break}return a},w={"upload.php":function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("query%5Bip-geo-block-auth-nonce%5D=")){delete a[b];break}return a},"theme-install.php":v,"network/theme-install.php":v},y=function(){var a=null;try{new URL("/","http://example.com/")}catch(b){try{a=(new DOMParser).parseFromString("<html><head></head><body></body></html>","text/html")}catch(e){a=n.implementation.createHTMLDocument("")}}return function(b,e){var d=n;b="undefined"!==typeof b?b:location.href;if(null===a){"undefined"===typeof e&&(e=location.href);try{var c=new URL(b,e)}catch(m){c=new URL(b,location.href)}}else{if("undefined"!==typeof e){for(d=a;d.head.firstChild;)d.head.removeChild(d.head.firstChild);c=d.createElement("base");c.setAttribute("href",e);d.head.appendChild(c)}d=d.createElement("a");d.setAttribute("href",b);d.setAttribute("href",d.href);c={protocol:d.protocol,host:d.host,hostname:d.hostname,port:d.port,pathname:d.pathname,search:d.search,hash:d.hash,href:d.href,username:"",password:"",origin:d.origin||null};"http:"===c.protocol&&"80"===c.port?(c.port="",c.host=c.host.replace(/:80$/,"")):"https:"===c.protocol&&"443"===c.port&&(c.port="",c.host=c.host.replace(/:443$/,""));if("http:"===c.protocol||"https:"===c.protocol)c.pathname&&"/"!==c.pathname.charAt(0)&&(c.pathname="/"+c.pathname),c.origin||(c.origin=c.protocol+"//"+c.hostname+(c.port?":"+c.port:""))}if(c.username||c.password)throw new URIError(c.username+":"+c.password);return c}}();g.ajaxPrefilter(function(a,b,e){1!==l(a.url)||a.url.match(/async-upload\.php$/)||("undefined"!==typeof h.FormData&&a.data instanceof FormData?a.data.append(f.auth,f.nonce):(b=p(a.url),"undefined"===typeof a.data||b.query?a.url=k(b,f.nonce):(b=a.data?a.data.split("&"):[],e=location.pathname,e=e.replace(IP_GEO_BLOCK_AUTH.home+IP_GEO_BLOCK_AUTH.admin,""),(e=w.hasOwnProperty(e)?w[e]:null)&&(b=e(b)),b.push(f.auth+"="+encodeURIComponent(f.nonce)),a.data=b.join("&"))))});"undefined"===typeof g.fn.onFirst&&(g.fn.onFirst=function(a,b){var e,d=g(this),c="string"===typeof b;g.fn.on.apply(d,arguments);if("object"===typeof a)for(e in a)a.hasOwnProperty(e)&&t(d,e,c);else"string"===typeof a&&t(d,a,c);return d});g(h).on("error",function(a){u(!1)});g(function(){u(!0)});(function(){var a=g(n);a.onFirst("click contextmenu","a",function(a){var b=g(this),d=b.attr("href"),c=b.attr("rel"),m=q(p(d))?l(d):0;if("click"===a.type)if(1===m)b.attr("href",k(d,!c||0>c.indexOf("nofollow")?f.nonce:"nofollow"));else if(-1===m&&r())if("_self"===b.attr("target"))for(a=d,d=f.sites.length,b=0;b<d;++b)a&&0<=a.indexOf(f.sites[b])&&f.nonce&&(h.location=k(a,f.nonce));else return d=x(decodeURIComponent(this.href)),d=d.split(";",2).shift(),m=h.open(),m.document.write('<!DOCTYPE html><html><head><meta name="referrer" content="never" /><meta name="referrer" content="no-referrer" /><meta http-equiv="refresh" content="0; url='+d+'" />'+(g("body").hasClass("webview")?'<script>window.location.replace("'+d+'")\x3c/script>':"")+"</head></html>"),m.document.close(),a.stopImmediatePropagation(),!1});a.onFirst("submit","form",function(a){a=g(this);var b=a.attr("action");1===l(b)&&a.attr("action",k(b,f.nonce))})})()})(jQuery,window,document);